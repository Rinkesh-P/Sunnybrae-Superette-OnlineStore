{% extends 'store/main.html' %}
{% load static %}
{% block content %}

     <h3>Cart</h3>
     <div class="row">
          <div class="col-lg-12">
               <div class="box-element">
                    <a class = "btn btn-outline-dark" href="{% url 'product' %}"> &#x2190; Continue Shopping </a>
                    <br>
                    <br>
                    
                    <table class="table">
                         <tr>
                              <th><h5>Items: <strong> {{order.get_cart_items|floatformat:0}} </strong></h5></th>
                              <th><h5>Total:<strong> ${{order.get_cart_total|floatformat:2}} </strong></h5></th>
                              <th>
                                   <a href="#">Checkout #not implemented yet </a>
                              </th>
                         </tr>
                    </table>

               </div>
     
               <br>
               <div class="box-element">
                    <div class="cart-row">
                         <div style="flex:2"></div>
                         <div style="flex:2"><strong>Item</strong></div>
                         <div style="flex:1"><strong>Price</strong></div>
                         <div style="flex:1"><strong>Quantity</strong></div>
                         <div style="flex:1"><strong>Total</strong></div>
                    </div>
                    
                    {%for item in items %}
                    <div class="cart-row">
                         <div style="flex:2"><img class="row-image" src="{% static 'images/placeholder.png' %}"></div>
                         <div style="flex:2"><p>{{item.product.item_name}}</p></div>
                         <div style="flex:1"><p>${{item.product.current_price|floatformat:2}}</p></div>
                         <div style="flex:1">
                              <p class="quantity">{{item.quantity}}</p>
                              <div class="quantity">
                                   <img class="chg-quantity" src="{% static  'images/arrow-up.png' %}" data-product = "{{item.product.item_id}}" data-action = "add">
                                   <img class="chg-quantity" src="{% static  'images/arrow-down.png' %}" data-product = "{{item.product.item_id}}" data-action = "remove">
                              </div>
                         </div>
                         <div style="flex:1"><p>${{item.get_total|floatformat:2}}</p></div>
                    </div>
                    {%endfor%}
               </div>
          </div>
     </div>

     <script>
          document.addEventListener("click", function (event) {
               if (event.target && event.target.classList.contains("chg-quantity")) {
                    const productId = event.target.getAttribute("data-product");
                    const action = event.target.getAttribute("data-action"); 
                    console.log ('Fucntion -- :', action) //checking if arrow click work
                    updateUserOrder(productId, action); 
               }
          });

          function updateUserOrder(productId, action) {
               const url = '/updateItem/';
               fetch(url, {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                       'X-CSRFToken': '{{ csrf_token }}'
                   },
                   body: JSON.stringify({ 'productId': productId, 'action': action })
               })
               .then(response => response.json())
               .then(data => {
                   console.log('Data:', data);
                   location.reload(); 
               });
           }
     </script>



{% endblock content %}
